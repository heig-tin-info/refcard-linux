\documentclass{article}

\usepackage[a4paper,landscape,margin=5mm]{geometry}
\usepackage[french]{babel}
\usepackage[most]{tcolorbox}
\usepackage[os=win]{menukeys}
\usepackage[fontsize=6.5pt]{scrextend}
\usepackage{enumitem}
\usepackage{environ}
\usepackage{fontawesome}
\usepackage{fontspec}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{microtype}
\usepackage{multicol}
\usepackage{ragged2e}
\usepackage{tabularx}
\usepackage{titlesec}
\usepackage{xparse}

\makeatletter
\AtBeginDocument{%
  % N'ajoute QUE la police; ne remplace pas le style entier
  \tikzset{
    tw@menus@base/.append style={font=\relsize{-0.5}\sffamily},
    tw@roundedmenus@base/.append style={font=\relsize{-0.5}\sffamily},
    tw@angularmenus@base/.append style={font=\relsize{-0.5}\sffamily},
    tw@roundedkeys@base/.append style={font=\relsize{-0.5}\sffamily},
    tw@shadowedroundedkeys@base/.append style={font=\relsize{-0.5}\sffamily},
  }%
}
\makeatother

\ifdefined\tinted
  \definecolor{tintedpage}{HTML}{d4d9d0}
  \pagecolor{tintedpage}
\fi

\setlength{\columnsep}{5mm}
\setlength{\columnseprule}{0.4pt}

\setlist{nosep,leftmargin=1.1em}
\setlength{\parindent}{0pt}
\setlength{\parskip}{2pt}

% \setmainfont{TeX Gyre Heros}
% \setsansfont{TeX Gyre Heros}
% \setmonofont{Inconsolata}
\renewcommand{\familydefault}{\sfdefault}

\setmonofont{Source Code Pro}[Scale=1.3]

\lstset{
  basicstyle=\ttfamily\scriptsize,
  columns=fullflexible,
  keepspaces=true,
  upquote=true,
  breaklines=true,
  literate=*%
    {[f]}{{\raisebox{0ex}{\scriptsize\faFileO}}}3
    {[fc]}{{\raisebox{0ex}{\scriptsize\faFileCodeO}}}4
    {[fa]}{{\raisebox{0ex}{\scriptsize\faFileArchiveO}}}4
    {[d]}{{\raisebox{0ex}{\scriptsize\faFolderO}}}3
    {[p]}{{\raisebox{0ex}{\scriptsize\faFilePowerpointO}}}2
    {[t]}{{\raisebox{0ex}{\scriptsize\faHashtag}}}2
    {uu}{{test}}2
}

\tcbset{
  codeinline/.style={
    on line,
    colframe=black!60, colback=white,
    opacityback=0.9,
    bottom=1.1pt, left=1.2pt, right=1.2pt, top=1.1pt,
    boxrule=0.2pt, arc=2pt, boxsep=0.2pt,
    fontupper=\ttfamily\scriptsize,
    before upper=\rule{0pt}{0.7em},
    tcbox raise base
  }
}

\NewDocumentCommand{\code}{O{} v}{%
  \tcbox[codeinline,#1]{\lstinline!#2!}%
}

\NewDocumentCommand{\codx}{O{} m}{%
  \tcbox[codeinline,#1]{#2}%
}

\renewmenumacro{\keys}[+]{roundedkeys}

\let\oldkeys\keys
\renewcommand{\keys}[1]{\small\oldkeys{#1}\normalsize}

% Tailles des titres (s'applique aussi aux versions étoilées *)
\titleformat{\section}
  {\sffamily\bfseries\fontsize{12}{15}\selectfont} % ajoute  si tu veux en gras
  {}{0pt}{}

\titleformat{\subsection}
  {\sffamily\bfseries\fontsize{9}{11}\selectfont}
  {}{0pt}{}

\titleformat{\subsubsection}
  {\sffamily\bfseries\fontsize{8}{10}\selectfont}
  {}{0pt}{}

% Espacements (les tiens, inchangés)
\titlespacing*{\section}{0pt}{0ex plus .1ex minus 0.5ex}{0.5ex plus .1ex minus 0.2ex}
\titlespacing*{\subsection}{0pt}{0.1ex plus .1ex minus 0.5ex}{0.5ex plus .1ex minus 0.2ex}
\titlespacing*{\subsubsection}{0pt}{0.1ex plus .1ex minus 0.5ex}{0.5ex plus .1ex minus 0.2ex}

\pagenumbering{gobble} % pas de numéros de page

\input{revision}

\newenvironment{cmdblock}{%
  \par\setlength{\parindent}{0pt}\setlength{\parskip}{0pt}%
  \RaggedRight%
}{\par}

\newcommand{\cmditem}[2]{%
  \noindent\inlinecode{#1}\quad #2\par
}

% indentation supplémentaire pour les sous-lignes (options)
\newlength{\cmdoptindent}
\setlength{\cmdoptindent}{1em} % ajuste au goût

\newcommand{\cmdopt}[1]{%
  \hspace*{\cmdoptindent}%
  \begin{minipage}[t]{\dimexpr\linewidth-\cmdoptindent\relax}
    \RaggedRight \itshape #1%
  \end{minipage}\par
}

\newcommand{\codefa}[2][]{%
  \raisebox{-0.15ex}{\faIcon[#1]{#2}}%
}

\setlength\parindent{0pt}
\setlength\tabcolsep{1.5pt}
\setlength{\columnseprule}{0.4pt}
\setlength{\multicolsep}{0pt}

\begin{document}
\raggedcolumns
\begin{multicols}{4}
    \raggedbottom

    \begin{tabularx}{\columnwidth}{llX}
        \raisebox{-\totalheight}{\includegraphics[width=1cm]{assets/heig-vd-black.pdf}} &
        \raisebox{-\totalheight}{\includegraphics[width=0.7cm]{assets/linux-logo.pdf}}  &
        \begin{center}
            {\Large \bf Référence Linux / Unix} \\
            version \revision \ -- \revisiondate \\
        \end{center}
    \end{tabularx}

    \begin{raggedright}
        Carte de référence des commandes et utilitaires Unix-like courants. Les marqueurs suivants sont utilisés : \code{[f]} : nom de fichier,
        \code{[d]} : nom de répertoire,
        \code{[p]} : commande,
        \code{"s"} : chaîne de caractères
    \end{raggedright}

    \section*{Bash}
    \subsection*{Mouvements}

    \begin{tabbing}
        aaaaaaaa \= aaaaaaaaaaaaaaaaaaaaa \= aaaaaaaa \= aaaaaaaaaaaa \kill
        \keys{\ctrl + B} \> recule d'un char (\keys{\leftarrow})   \>
        \keys{\ctrl + F} \> avance d'un char (\keys{\rightarrow})  \\
        \keys{\ctrl + A} \> début ligne (\keys{Home})                \>
        \keys{\ctrl + E} \> fin ligne (\keys{End})                   \\
        \keys{\Alt + B}  \> recule mot (\keys{\Alt + \leftarrow})  \>
        \keys{\Alt + F}  \> avance mot (\keys{\Alt + \rightarrow})
    \end{tabbing}

    \subsection*{Édition}

    \begin{tabbing}
        aaaaaaaaaa \= a \kill
        \keys{\ctrl + H} \> backspace (\keys{\backspace})    \\
        \keys{\ctrl + D} \> delete (\keys{\del})             \\
        \keys{\ctrl + U} \> coupe du début au curseur              \\
        \keys{\ctrl + K} \> coupe du curseur à la fin              \\
        \keys{\ctrl + W} \> coupe le mot avant le curseur          \\
        \keys{\ctrl + Y} \> colle le dernier texte coupé           \\
        \keys{\ctrl + T} \> swap le char courant avec le précédent \\
        \keys{\Alt + D}  \> supprime le mot après                  \\
        \keys{\Alt + .}  \> insère le dernier argument
    \end{tabbing}

    \subsection*{Exécution / complétion}

    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaa \= a \kill
        \keys{\ctrl + J}, \keys{\ctrl + M} exécuter (\keys{\return}) \\
        \keys{\ctrl + I} \> complétion (équivalent \keys{\tab})                           \\
        \keys{\tab}{}    \> auto-complétion
    \end{tabbing}

    \subsection*{Contrôle / Appels système}

    \begin{tabbing}
        aaaaaaaa \= aaaaaaaaaaaaaaaaa \= aaaaaaaa \= aaaaaaaaaaa \kill
        \keys{\ctrl + C} \> interrompre (\emph{sigint}) \> \keys{\ctrl + Z} \> suspendre (\emph{sigstp}) \\
        \keys{\ctrl + L} \> effacer l'écran \>
        \keys{\ctrl + D} \> envoyer \emph{EOF} (ferme le shell)
    \end{tabbing}

    \subsection*{Historique / recherche}

    \begin{tabbing}
        aaaaaaaa \= aaaaaaaaaaaaaaaaaaaa \= aaaaaaaa \= aaaaaaaaaaa \kill
        \keys{\ctrl + R} \> recherche historique                \>
        \keys{\ctrl + G} \> annuler la recherche                \\
        \keys{\ctrl + P} \> commande précédente                 \>
        \keys{\ctrl + N} \> commande suivante                   \\
        \keys{\ctrl + S} \> pause                               \>
        \keys{\ctrl + Q} \> reprise                             \\
        \keys{\Alt + <}  \> début de l'historique               \>
        \keys{\Alt + >}  \> fin de l'historique                 \\
        \keys{\Alt + P}  \> précédent dans l'hist.         \>
        \keys{\Alt + N}  \> suivant dans l'hist.
    \end{tabbing}

    \subsection*{Casse / mots}

    \begin{tabbing}
        aaaaaaa \= aaaaaaaaaaaaaaaaaaaaa \= aaaaaaa \= aaaaaaaaaaa \kill
        \keys{\Alt + U} \> majuscules (mot après)        \>
        \keys{\Alt + L} \> minuscules (mot après)        \\
        \keys{\Alt + C} \> capitalise la première lettre
    \end{tabbing}

    \subsection*{Sucres syntaxiques}

    \begin{tabbing}
        aaaaaaaa \= aaaaaaaaaaaaaaaaaaa \= aaaaaaaa \= aaaaaaaaaaa \kill
        \code|~| \> identique à \codx{\$HOME} \>
        \code|.| \> répertoire courant \\
        \code|..| \> répertoire parent \>
        \code|!!| \> dernière commande \\
        \code|!n| \> cmd. \#n de l'hist. \>
        \codx{\$?} \> code retour last cmd. \\
        \codx{\$0} \> nom du script \>
        \code{!*} \> arguments ancienne cmd. \\
        \code{^ab^12} \> subst. dans last cmd. \>
        \code{`cmd`} \> obsolète, comme \codx{\$(cmd)} \\
        \codx{\$(cmd)} \> subst. de commande \>
        \codx{\${var}} \> rendu de variable \\
        \code{{a,b,c}} \> exp. par alternatives \>
        \code{{1..5}} \> expansions de séquence \\
        \codx{\$(cmd1; cmd2)}  sous-coquille
        \codx{\$(cmd \&)}  arrière-plan (sous-coquille) \\
        \codx{\$(( expr ))} arithmétique (p.ex \codx{\$((i++))}) \\
        \codx{diff <(cmd1) <(cmd2)} \quad compare sorties sans fichiers \\
    \end{tabbing}

    \subsection*{Redirections / pipes}
    \begin{tabbing}
        aaaaaaaaaaa \= a \kill
        \code|[p] > [f]| \> stdout \textrightarrow{} fichier (écrase) \\
        \code|[p] >> [f]| \> stdout \textrightarrow{} fichier (ajout) \\
        \code|[p] 2> [f]| \> stderr \textrightarrow{} fichier (écrase) \\
        \code|[p] &> [f]| \> stdout+stderr \textrightarrow{} fichier (écrase) \\
        \code|[p] &>> [f]| \> stdout+stderr \textrightarrow{} fichier (ajout) \\
        \code|[p] < [f]| \> stdin depuis fichier \\
        \code|[p] << EOF| \> heredoc (jusqu'à EOF) \\
        \code|[p] <<< "s"| \> here-string (inject sur stdin) \\
        \code{[p] | [p]} \> pipe (stdout \textrightarrow{} stdin) \\
        \code{[p] |& [p]} \> pipe (stdout+stderr \textrightarrow{} stdin)
    \end{tabbing}

    \subsection*{Exécution de commandes}
    \begin{tabbing}
        aaaaaaaaaaa \= a \kill
        \code|source [f]| \> exécute script dans contexte \\
        \code|./[p]| \> exécute programme dans rép. courant \\
        \code|sh -c "[p]"| \> exécute commande dans un shell \\
        \code|#!/usr/bin/env bash| \quad shebang pour bash \\

        %\code|[p] ; [p]| \> exécute commandes successivement \\
    \end{tabbing}

    \subsection*{Boucles express}
    \code|for f in *.log; do grep -H "ERR" "$f"; done| \\
        \code|while read -r url; do curl -I "$url"; done < urls.txt| \\
    \code{seq 1 5 | xargs -I{} echo ligne {}} \\
    \code{find . -type f -print0 | xargs -0 -n1 -P4 sha256sum}

    \subsection*{Globbing / motifs}
    \begin{tabbing}
        aaaaaaaaaaaa \= a \kill
        \code|*.log| \> fichiers se terminant par .log \\
        \code|file?.txt| \> un seul caractère \\
        \code|[abc].txt| \> classe de caractères \\
        \code|[^0-9]*| \> tout sauf chiffres (selon shell) \\
        \code|**/*.py| \> récursif (bash \ge 4: \code{shopt -s globstar}) \\
        \code|!(tmp)| \> négation (extglob: \code{shopt -s extglob})
    \end{tabbing}

    \subsection*{Tests / conditions}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaa \= a \kill
        \code|[ -f [f] ]| \> fichier régulier \\
        \code|[ -d [d] ]| \> répertoire \\
        \code|[ -x [f] ]| \> exécutable \\
        \code|[ -n "s" ]| \> chaîne non vide \\
        \code|[ -z "s" ]| \> chaîne vide \\
        \code|[ n1 -eq n2 ]| \> égalité numérique \\
        \code|[ s1 = s2 ]| \> égalité chaîne \\
        \code|test ...| \> identique à \code|[ ... ]| \\
        \code|[[ ... ]]| \> tests étendus (globs/regex) \\
        \code|cmd1 && cmd2| \> exécute cmd2 si cmd1 réussit \\
        \code{cmd1 || cmd2} \> sinon \\
        \code|if cmd; then ...; fi| condition sur le code retour
    \end{tabbing}

    \section*{Gestion utilisateurs \& groupes}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|sudo adduser alice| \> crée un utilisateur (Debian/Ubuntu) \\
        \code|sudo passwd alice| \> change le mot de passe \\
        \code|sudo deluser alice| \> supprime l'utilisateur \\
        \code|sudo groupadd dev| \> crée un groupe \\
        \code|id alice| \> UID/GIDs de alice \\
        \code|sudo usermod -aG grp user| ajoute au groupe
    \end{tabbing}

    \section*{Information utilisateur}
    \begin{tabbing}
        aaaaaaaaaaaaaaaa \= a \kill
        \code|uptime| \> temps écoulé depuis reboot \\
        \code|date| \> date et heure actuelles \\
        \code|cal| \> calendrier du mois en cours \\
        \code|whoami| \> nom de l'utilisateur courant \\
        \code|hostname| \> nom de la machine \\
        \code|arch| \> architecture matérielle \\
        \code|lsb_release -a| \> infos distribution Linux
    \end{tabbing}

    \section*{Fichiers / répertoires}

    \begin{cmdblock}
        \code|pwd| \quad chemin répertoire courant \\
        \code|ls| \quad liste les fichiers \\
        \cmdopt{\codx{-l} détails, \codx{-a} fichiers cachés,
            \codx{-h} tailles lisibles, \codx{-R} récursif,
            \codx{-t} trier par date, \codx{-r} ordre inverse,
            \codx{-Q} guillemets, \codx{-i} inode,
            \codx{-d} répertoires seulement, \codx{-S} trier par taille,
            \codx{-1} un par ligne}
        \code|cd [d]| \quad change de répertoire \\
        \code|touch [f]| \quad crée fichier vide ou met à jour date \\
        \code|mkdir [d]| \quad crée un répertoire. \\
        \cmdopt{\codx{-v} verbeux,
        \codx{-p} parents si besoin,
        \codx{-m [perms]} permissions}
        \code|rmdir [d]| \quad supprime un répertoire vide \\
        \code|rm [f]| \quad supprime un fichier. \\
        \cmdopt{\codx{-i} interactif,
            \codx{-f} force,
            \codx{-v} verbeux,
            \codx{-r} récursif, (\codx{rm -rf} dangereux)}

        \code|cp [src] [dst]| \quad copie un fichier/répertoire. \\
        \cmdopt{\codx{-a} archive (récursif + attributs),
            \codx{-i} interactif,
            \codx{-f} force,
            \codx{-v} verbeux,
            \codx{-r} récursif}
        \code|mv [src] [dst]| \quad déplace/renomme. \\
        \cmdopt{\codx{-i} interactif,
            \codx{-f} force,
            \codx{-n} ne pas écraser,
            \codx{-v} verbeux}
        \code|ln -s [src] [dst]| \quad crée un lien symbolique
    \end{cmdblock}

    \section*{Texte}
    \begin{tabbing}
        aaaaaaaaaaaaa \= a \kill
        \code|paste a b| \> fusionne lignes côte à côte \\
        \code|join a b| \> jointure sur 1\iere\ colonne triée \\
        \code|tac [f]| \> cat inversé (bas \textrightarrow{} haut) \\
        \code|nl -ba [f]| \> numérote lignes \\
        \code|fmt -w 72 [f]| \> reformate texte (largeur 72) \\
        \code|fold -w 72 [f]| \> coupe lignes (largeur 72) \\
        \code|strings [f]| \> extrait chaînes imprimables \\
        \code|tr 'a-z' 'A-Z' < [f]| translate majuscules \\
        \code|iconv -f enc1 -t enc2 [f]| convertit encodage
    \end{tabbing}

    \section*{Consultation de fichiers}
    \begin{cmdblock}
        \code|file [f]|\quad type du fichier\par
        \code|stat [f]|\quad infos détaillées\par
        \code|wc [f]|\quad compte occurrences\par
        \cmdopt{\codx{-l} lignes, \codx{-w} mots, \codx{-c} caractères}
        \code{head [f]}\quad affiche premières lignes\par
        \cmdopt{\codx{-n N} N premières lignes}
        \code|tail [f]| \quad affiche les dernières lignes \\
        \cmdopt{\codx{-n N} N dernières lignes,
            \codx{-f} temps réel}
        \code|less [f]| \quad affiche page par page \\
        \code|cat [f]| \quad affiche le contenu \\
        \code|hexdump -C [f]| \quad affiche en hexadécimal \\
        \code|diff [f1] [f2]| \quad comparaison ligne par ligne \\
        \code|cmp [f1] [f2]| \quad comparaison byte par byte \\
        \code|sha256sum [f]| \quad somme de contrôle SHA256 \\
        \code|tree [d]| \quad arborescence (si installé) \\
        \code|du -sh [f/d]| \quad taille fichier/répertoire
    \end{cmdblock}

    \section*{Variables d'environnement}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaa \= a \kill
        \code|set| \> liste variables et fonctions \\
        \code|env| \> liste les variables d'env. \\
        \code|export VAR=[s]| \> crée/mod. variable d'env. \\
        \code|unset VAR| \> supprime une variable \\
        \code|printenv [VAR]| \> affiche variable(s) \\
        \code|echo \$VAR| \> affiche valeur variable \\
        \codx{\$PATH} \> chemin des exécutables \\
        \codx{\$HOME} \> répertoire personnel \\
        \codx{\$SHELL} \> interpréteur de commandes \\
        \codx{\$USER} \> nom de l'utilisateur \\
        \codx{\$PS1} \> invite de commande \\
        \codx{\$PWD} \> répertoire courant \\
        \codx{\$OLDPWD} \> répertoire précédent
    \end{tabbing}

    \section*{Processus / jobs}
    \begin{tabbing}
        aaaaaaaaaaaaaaa \= a \kill
        \code|[p]&| \> exécute en arrière-plan \\
        \code|jobs| \> liste les jobs en cours \\
        \code|wait [PID]| \> attend la fin d'un job \\
        \code|disown [PID]| \> détache un job du shell \\
        \code|fg [j]| \> ramène un job au premier plan \\
        \code|bg [j]| \> relance un job en arrière-plan \\
        \code|ps aux| \> liste les processus \\
        \code|pgrep [nom]| \> trouve PID par nom \\
        \code|pkill [nom]| \> tue processus par nom \\
        \code|kill [pid]| \> termine un processus \\
        \code|killall [p]| \> termine tous les processus nommés \\
        \code|nohup [p]| \> lance sans interruption \\
        %\code|screen/tmux| \> sessions persistantes \\
        \code|top| \> moniteur de processus \\
        \code|htop| \> top amélioré (si installé)

    \end{tabbing}

    \section*{Archives / compression}
    \begin{cmdblock}
        \code|tar -czvf archive.tar.gz [f]| \quad crée archive .tar.gz \\
        \code|tar -xzvf archive.tar.gz| \quad extrait archive .tar.gz \\
        \code|zip archive.zip [f]| \quad crée archive .zip \\
        \code|unzip archive.zip| \quad extrait archive .zip \\
        \code|tar -cJvf archive.tar.xz [f]| \quad crée archive .tar.xz \\
        \code|tar -xJvf archive.tar.xz| \quad extrait archive .tar.xz \\
        \code|7z a archive.7z [f]| \quad crée archive .7z \\
        \code|7z x archive.7z| \quad extrait archive .7z \\
        \code|bsdtar -xf [f]| \quad extrait \\
        \code|bsdtar -cf archive.tar [f]| \quad crée archive .tar
    \end{cmdblock}

    \section*{Permissions / utilisateurs}

    \begin{cmdblock}
        \code|chmod| \quad modifie les permissions \\
        \cmdopt{\codx{u} user, \codx{g} group, \codx{o} others, \codx{a} all,
            \codx{+} add, \codx{-} remove, \codx{=} set exactly, \codx{chmod 4755 f} (suid), \codx{chmod 2755 d} (setgid)}
        \code|chown| \quad change le propriétaire \\
        \code|chgrp| \quad change le groupe \\
        \code|umask| \quad masque de création de fichiers \\
        \code|sudo [p]| \quad exécute en superutilisateur \\
        \code|su [utilisateur]| \quad change d'utilisateur \\
        \code|who| \quad qui est connecté \\
        \code|w| \quad qui est connecté et que font-ils \\
        \code|id| \quad informations sur l'utilisateur courant \\
        \code|groups| \quad groupes de l'utilisateur courant \\
        \code|passwd| \quad change le mot de passe \\
        \code|last| \quad historique des connexions
    \end{cmdblock}

    \textit{bits :} 1 x, 2 w, 4 r.

    \section*{Raccourcis less / more / man}
    \begin{tabbing}
        aaaaaaaa \= aaaaaaaaaaaaaaaaaaaaa \= aaaaaaa \= aaaaaaaaaaa \kill
        \keys{Space} \> Espace: page suivante \>  \keys{b} \>  page précédente \\
        \keys{\return}{} \>  ligne suivante \>  \keys{y} \>  ligne précédente \\
        \keys{/} \>  rechercher \> \keys{n}/\keys{N} \>  suivant/précédent \\
        \keys{g}/\keys{G} \>  début/fin \>  \keys{q} \>  quitter \\
        \keys{h} \>  aide \>  \keys{m} \>  marque-page \\
        \keys{'} \>  aller au marque-page \>  \keys{`} \>  revenir
    \end{tabbing}


    \section*{Recherche}
    \begin{cmdblock}
        \code|grep "s" [f]| \quad cherche une chaîne dans un fichier \\
        \cmdopt{\codx{-P} regex Perl,
            \codx{-r} récursif,
            \codx{-i} ignore la casse,
            \codx{-v} inverse (non),
            \codx{-n} numéro de ligne,
            \codx{-c} compte les lignes,
            \codx{-l} liste les fichiers,
            \codx{-w} mot entier,
            \codx{-A n} n lignes après,
            \codx{-B n} n lignes avant,
            \codx{-C n} n lignes contexte,
            \codx{-o} seulement correspondance}
        \code|rg "s" [f]| \quad comme grep, plus rapide (si installé) \\
        \code|find [d] -name "s"| \quad cherche un fichier \\
        \cmdopt{\codx{-iname} ignore la casse,
            \codx{-type f/d} fichier/répertoire,
            \codx{-exec cmd \{\} \;} exécute cmd sur chaque fichier}
        \code|locate "s"| \quad cherche un fichier (base de données) \\
        \code|which [p]| \quad chemin d'une commande
    \end{cmdblock}

    \section*{Remplacement}
    \begin{cmdblock}
        \code|sed 's/search/new/g' [f]| \quad remplace avec BRE regex \\
        \cmdopt{\codx{-i} modifie le fichier,
            \codx{-n} n'affiche rien par défaut,
            \codx{-E} regex étendues,
            \codx{-e} script, \codx{-r} regex étendues}
        \code|perl -pe 's/search/new/g' [f]| \quad remplace avec regex Perl \\
        \cmdopt{\codx{-i} modifie le fichier,
            \codx{-n} n'affiche rien par défaut,
            \codx{-e} script, \codx{-l} gère les nouvelles lignes}
        \code|perl -0777 -pe 's/search/new/gs' [f]| \quad remplace sur tout le fichier \\
    \end{cmdblock}

    \section*{Utilitaires}
    \begin{cmdblock}
        \code|uniq [f]| \quad filtre les lignes consécutives identiques \\
        \cmdopt{\codx{-c} compte, \codx{-d} que les doublons,
            \codx{-u} que les uniques, \codx{-i} ignore la casse}
        \code|sort [f]| \quad trie les lignes \\
        \cmdopt{\codx{-r} inverse, \codx{-n} numérique,
            \codx{-k n} clé n, \codx{-u} unique,
            \codx{-t x} séparateur x}
        \code|cut -d x -f n [f]| \quad extrait le champ n, séparé par x \\
        \code|awk '{print \$n}' [f]| \quad extrait le champ n (espace séparateur) \\
        \code|xargs [p]| \quad construit des lignes de commande \\
        \cmdopt{\codx{-n N} N arguments par commande,
            \codx{-I \{\}} remplace \{\} par l'argument}
        \code|tr 'set1' 'set2'| \quad remplace set1 par set2 \\
        \cmdopt{\codx{-d} supprime set1, \codx{-s} squeeze}
        \code|tee [f]| \quad duplique le flux vers un fichier \\
        \cmdopt{\codx{-a} ajoute au fichier, \codx{-i} ignore les signaux}
    \end{cmdblock}

    \section*{Aide}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaa \= a \kill
        \code|help [p]| \> aide interne bash \\
        \code|[p] --help| \> aide d'une commande \\
        \code|man [p]| \> manuel d'une commande \\
        \code|apropos [terme]| \> cherche dans les manuels \\
        \code|whatis [p]| \> description commande
    \end{tabbing}

    \emph{Sections du manuel: 1~utilisateur, 2~syscalls, 3~lib, 4~spéciaux, 5~formats, 6~jeux, 7~divers, 8~admin.} (\code{man 3 printf})

    \section*{Gestion Réseau}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaa \= a \kill
        \code|ip a| \> liste adresses IP \\
        \code|ip r| \> table de routage \\
        \code|ping [hôte]| \> teste la connectivité \\
        \code|ss -tuln| \> sockets réseau \\
        \code|dig [hôte]| \> résolution DNS avancée \\
        \code|nslookup [hôte]| \> résolution DNS simple \\
        \code|traceroute [hôte]| \> trace la route \\
        \code|netstat -tuln| \> sockets (ancien) \\
        \code|mtr [hôte]| \> traceroute+ping continu \\
        \code|arp -a| \> table ARP
    \end{tabbing}

    \section*{SSH}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|ssh user@host| \> connexion SSH \\
        \code|scp [src] [dst]| \> copie sécurisée \\
        \code|ssh-keygen| \> génère une clé \\
        \code|ssh-copy-id user@host| \> installe la clé sur hôte \\
        \code|ssh -J bastion cible| \> ProxyJump (bastion)
    \end{tabbing}

    \section*{Internet}
    \begin{cmdblock}
        \code|wget [url]| \quad télécharge un fichier \\
        \cmdopt{\codx{-O f} fichier de sortie,
            \codx{-c} reprendre, \codx{-q} silencieux,
            \codx{--limit-rate=100k} limite le débit}
        \code|curl [url]| \quad transfère une URL \\
        \cmdopt{\codx{-o f} fichier de sortie,
            \codx{-O} nomme comme l'original,
            \codx{-L} suivre redirections,
            \codx{-I} en-têtes seulement,
            \codx{-d data} données POST,
            \codx{-H 'Hdr: v'} ajoute un en-tête}
        %\code|lynx [url]| \quad navigateur web en console \\
    \end{cmdblock}

    \section*{Git}
    \begin{cmdblock}
        \code|git init| \quad initialise un dépôt git \\
        \code|git status| \quad statut du dépôt \\
        \code|git remote add origin [url]| \quad ajoute une origine \\
        \code|git remote -v| \quad liste les origines \\
        \code|git fetch| \quad récupère les changements distants \\
        \code|git pull| \quad pull + merge \\
        \cmdopt{
            \codx{--rebase} rebase au lieu de merge}
        \code|git reset [br]| \quad réinitialise la branche courante \\
        \cmdopt{\codx{--hard} réinitialise aussi les fichiers,
            \codx{--soft} garde les fichiers modifiés}
        \code|git push| \quad pousse les changements \\
        \code|git clone [url]| \quad clone un dépôt distant \\
        \code|git branch| \quad liste les branches \\
        \code|git branch [br]| \quad crée une branche \\
        \code|git checkout [br]| \quad change de branche \\
        \code|git commit -m "s"| \quad crée un commit \\
        \cmdopt{\codx{-a} ajoute tous les fichiers modifiés,
            \codx{-m "msg"} message du commit,
            \codx{--amend} modifie le dernier commit}
            \codx{--allow-empty} commit même si rien à committer \\
        \code|git add [f]| \quad ajoute un fichier au commit \\
        \code|git switch -c br| \quad crée \& bascule (nouveau) \\
        \code|git restore --staged [f]| \quad retire de l'index \\
        \code|git stash -u| \quad met de côté (inclut non suivis) \\
        \code|git cherry -v main| \quad commits non poussés \\
        \code|git bisect start ...| \quad recherche bogue binaire \\
        \code|git log| \quad historique des commits \\
        \cmdopt{\codx{--oneline} résumé, \codx{--graph} graphe,
            \codx{--stat} stats, \codx{-p} diff}
    \end{cmdblock}

    \section*{GCC}
    \begin{cmdblock}
        \code|gcc [f.c]| \quad compile un fichier C \\
        \cmdopt{\codx{-o f} nom de l'exécutable,
            \codx{-Wall} tous les avertissements,
            \codx{-Wextra} avertissements supplémentaires,
            \codx{-g} infos debug,
            \codx{-O0, -O1, -O2, -O3} optimisation,
            \codx{-std=c17} standard C,
            \codx{-I dir} inclure répertoire dir,
            \codx{-L dir} lier répertoire dir,
            \codx{-l lib} lier la bibliothèque lib
            \codx{-c} compiler seulement (pas linker)}
    \end{cmdblock}

    \section*{Débug/Profiler}
    \begin{cmdblock}
        \code strace -f -o out.log [p]| Trace les appels système \\
        \cmdopt{\codx{-f} suit les processus fils,
            \codx{-e trace=desc} trace seulement les descripteurs,
            \codx{-e trace=file} trace seulement les accès fichiers,
            \codx{-e trace=network} trace seulement le réseau,
            \codx{-p PID} attache à un processus existant,
            \codx{-c} résumé des appels}
        \code|ltrace -f -o out.log [p]| Trace les appels de fonctions \\
        \cmdopt{\codx{-f} suit les processus fils,
            \codx{-p PID} attache à un processus existant,
            \codx{-c} résumé des appels}
        \code|gdb [p]| \quad débugge un programme \\
        \cmdopt{\codx{-q} silencieux,
            \codx{run} lance le programme,
            \codx{break n/fonction} met un point d'arrêt,
            \codx{next} ligne suivante (sans entrer dans les fonctions),
            \codx{step} ligne suivante (en entrant dans les fonctions),
            \codx{continue} continue jusqu'au prochain point d'arrêt,
            \codx{print var} affiche la variable,
            \codx{backtrace} pile d'appels,
            \codx{list} affiche le code source,
            \codx{quit} quitte gdb}
        \code|valgrind --leak-check=full [p]| \quad détecte fuites mémoire \\
        \code|perf stat [p]| \quad statistiques d'exécution \\
        \code|perf record [p]| \quad enregistre les échantillons \\
        \code|perf report| \quad affiche le rapport
    \end{cmdblock}
    \section*{Python}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|python -mvenv venv| \> crée un virtual env. \\
        \code|source venv/bin/activate| \> active l'env. virtuel (bash) \\
        \codx{venv\textbackslash{}Scripts\textbackslash{}activate} \> même chose (PowerShell) \\
        \code|uv venv venv| \> même chose avec uv \\
        \code|deactivate| \> désactive l'env. virtuel \\
        \code|pip list| \> liste les paquets installés \\
        \code|pip install pkg| \> installe un paquet dans l'env. \\
        \code|pipx install pkg| \> installe un outil globalement
    \end{tabbing}

    \section*{Docker (conteneurs)}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|docker ps| \> conteneurs actifs \\
        \code|docker images| \> liste les images \\
        \code|docker run [img]| \> lance un conteneur \\
        \code|docker stop [id]| \> arrête un conteneur \\
        \code|docker rm [id]| \> supprime un conteneur \\
        \code|docker pull [img]| \> télécharge une image \\
        \code|docker logs -f [id]| \> logs en direct \\
        \code|docker build -t [nom] .| crée une image depuis Dockerfile \\
        \code|docker exec -it [id] /bin/bash| shell dans conteneur \\
        \codx{docker run -it -v\$(pwd):/data [img]} volume partagé \\
    \end{tabbing}

    \section*{Système}

    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|shutdown -h now| \> arrête le système \\
        \code|shutdown -r now| \> redémarre le système \\
        \code|systemctl status [srv]| \> statut d'un service \\
        \code|systemctl start [srv]| \> démarre un service \\
        \code|systemctl stop [srv]| \> arrête un service \\
        \code|systemctl restart [srv]| \> redémarre service \\
        \code|systemctl enable [srv]| \> active service \\
        \code|systemctl disable [srv]| \> désactive service \\
        \code|journalctl -xe| \> logs système \\
        \code|journalctl -f| \> suit logs temps réel \\
        \code|timedatectl| \> date, heure, fuseau horaire \\
        \code|hostnamectl| \> informations sur le système
    \end{tabbing}

    \section*{Planification (cron)}
    \begin{tabbing}
        aaaaaaaaaaaaaaaa \= a \kill
        \code|crontab -e| \> édite crontab utilisateur \\
        \code|crontab -l| \> liste tâches planifiées \\
        % \code|crontab -r| \> supprime crontab \\
        \code|at 15:30| \> programme tâche unique \\
        \code|atq| \> liste tâches at
        % \code|atrm [id]| \> supprime tâche at \\
    \end{tabbing}

    \emph{Format crontab:} \codx{min heure jour mois jourSem commande} \\
    \emph{Exemples:} \codx{0 2 * * *} (2h), \codx{*/15 * * * *} (chaque 15min)

    \section*{Hardware}

    \begin{tabbing}
        aaaaaaaaaaaaaaaa \= a \kill
        \code|uname -a| \> informations système \\
        \code|lscpu| \> infos CPU \\
        \code|lsblk| \> liste les disques et partitions \\
        \code|df -h| \> espace disque \\
        \code|du -sh [f/d]| \> taille d'un fichier/répertoire \\
        \code|free -h| \> mémoire \\
        \code|lshw| \> matériel détaillé \\
        \code|lspci| \> périphériques PCI \\
        \code|lsusb| \> périphériques USB \\
        \code|dmidecode| \> infos BIOS/matériel \\
        \code|sensors| \> températures/ventilateurs
    \end{tabbing}

    \section*{APT (Debian/Ubuntu)}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|apt update| \> met à jour liste des paquets \\
        \code|apt upgrade| \> met à jour les paquets installés \\
        \code|apt install [pkg]| \> installe un paquet \\
        \code|apt remove [pkg]| \> désinstalle un paquet \\
        \code|apt search [terme]| \> cherche un paquet \\
        \code|apt show [pkg]| \> informations sur un paquet \\
        %\code|apt autoremove| \> supprime dépendances inutiles \\
        \code|dpkg -L [pkg]| \> liste fichiers d'un paquet \\
        \code|dpkg -S [f]| \> quel paquet fournit ce fichier
    \end{tabbing}



    \section*{Disques / systèmes de fichiers}
    \begin{cmdblock}
        \code|mount [device] [mountpoint]| \quad monte un système de fichiers \\
        \code|umount [mountpoint]| \quad démonte un système de fichiers \\
        \code|lsblk -f| \quad liste disques avec systèmes de fichiers \\
        \code|fdisk -l| \quad liste les partitions \\
        \code|fsck [device]| \quad vérifie un système de fichiers \\
        \cmdopt{\codx{-f} forcer, \codx{-y} répond oui automatiquement}
        \code|mkfs.ext4 [device]| \quad crée système de fichiers ext4 \\
        \code|rsync -av [src] [dst]| \quad synchronise répertoires \\
        \cmdopt{\codx{-a} archive, \codx{-v} verbeux, \codx{-z} compression,
            \codx{--delete} supprime fichiers destination}
    \end{cmdblock}

    \section*{Éditeurs de texte}
    \begin{cmdblock}
        \code|nano [f]| \quad éditeur simple \\
        \cmdopt{\keys{\ctrl + X} quitter, \keys{\ctrl + O} sauver,
            \keys{\ctrl + W} chercher, \keys{\ctrl + K} couper ligne}
        \code|vi/vim [f]| \quad éditeur vi/vim \\
        \cmdopt{\keys{i} insertion, \keys{Esc} mode commande,
            \codx{:w} sauver, \codx{:q} quitter, \codx{:wq} sauver+quitter,
            \codx{:q!} quitter sans sauver, \codx{/text} chercher}
    \end{cmdblock}

    % \section*{Performance système}
    % \begin{tabbing}
    %     aaaaaaaaaaaaaaaa \= a \kill
    %     \code|iostat| \> statistiques E/S disques \\
    %     \code|vmstat| \> statistiques virtuelles \\
    %     \code|sar| \> rapports d'activité système \\
    %     \code|nload| \> moniteur réseau temps réel \\
    %     \code|iotop| \> top pour les E/S \\
    %     \code|lsof| \> fichiers ouverts \\
    % \end{tabbing}

    % \section*{YUM/DNF (Red Hat/Fedora)}
    % \begin{tabbing}
    %     aaaaaaaaaaaaaaaa \= a \kill
    %     \code|dnf update| \> met à jour les paquets \\
    %     \code|dnf install [pkg]| \> installe un paquet \\
    %     \code|dnf remove [pkg]| \> désinstalle un paquet \\
    %     \code|dnf search [terme]| \> cherche un paquet \\
    %     \code|dnf info [pkg]| \> infos sur un paquet \\
    %     \code|dnf list installed| \> paquets installés \\
    % \end{tabbing}

    % \section*{Pacman (Arch Linux)}
    % \begin{tabbing}
    %     aaaaaaaaaaaaaaaa \= a \kill
    %     \code|pacman -Syu| \> met à jour système \\
    %     \code|pacman -S [pkg]| \> installe un paquet \\
    %     \code|pacman -R [pkg]| \> désinstalle un paquet \\
    %     \code|pacman -Ss [terme]| \> cherche un paquet \\
    %     \code|pacman -Si [pkg]| \> infos sur un paquet \\
    %     \code|pacman -Q| \> paquets installés \\
    % \end{tabbing}



    % \section*{Sécurité / Firewall}
    % \begin{tabbing}
    %     aaaaaaaaaaaaaaaa \= a \kill
    %     \code|ufw status| \> statut firewall Ubuntu \\
    %     \code|ufw enable| \> active le firewall \\
    %     \code|ufw allow [port]| \> autorise un port \\
    %     \code|firewall-cmd --list-all| \> config firewall \\
    %     \code|iptables -L| \> règles iptables \\
    %     \code|fail2ban-client status| \> statut fail2ban \\
    % \end{tabbing}

    \section*{Répertoires système importants}
    \begin{tabbing}
        aaaaaaaaaaaaaaaa \= a \kill
        \codx{/etc/} \> fichiers de configuration \\
        \codx{/var/log/} \> fichiers de logs \\
        \codx{/tmp/} \> fichiers temporaires \\
        \codx{/usr/bin/} \> exécutables utilisateur \\
        \codx{/usr/local/} \> programmes installés localement \\
        \codx{/opt/} \> packages optionnels \\
        \codx{/proc/} \> infos processus et noyau \\
        \codx{/sys/} \> infos matériel système \\
        \codx{~/.bashrc} \> config shell utilisateur \\
        \codx{/etc/hosts} \> résolution de noms locale
    \end{tabbing}

    \section*{Sécurité / Pare-feu}
    \begin{tabbing}
        aaaaaaaaaaaaaaaaaaaa \= a \kill
        \code|ufw status| \> statut pare-feu Ubuntu \\
        \code|ufw enable| \> active le pare-feu \\
        \code|ufw allow [port]| \> autorise un port \\
        \code|ufw deny [port]| \> refuse un port \\
        \code|iptables -L| \> affiche règles iptables \\
        \code|iptables -A INPUT -p tcp --dport [port] -j ACCEPT| Autorise \\
        \code|iptables -A INPUT -p tcp --dport [port] -j DROP| Refuse \\
        \code|iptables -t nat -A PREROUTING ... -j REDIRECT --to-port p| \\

        \code|fail2ban-client status| statut fail2ban \\
        \code|lastlog| \> dernières connexions \\
        \code|sudo -l| \> droits sudo de l'utilisateur
    \end{tabbing}


    \section*{Fun}

    \begin{tabbing}
        aaaaaaaaaaaaaaa \= a \kill
        \code|cowsay "s"| \> phylactère et vache \\
        \code|fortune| \> citation aléatoire  \\
        \code|sl| \> locomotive à vapeur  \\
        \code|cmatrix| \> effet Matrix  \\
        \code|toilet "s"| \> texte ASCII art  \\
        \code|lolcat| \> texte coloré
    \end{tabbing}

    \section*{Substituts modernes}

    \begin{tabularx}{\columnwidth}{lX}
        lsd          & Substitut de ls             \\
        batcat       & Amélioration de cat         \\
        fd           & Substitut de find           \\
        ripgrep (rg) & Substitut de grep           \\
        sd           & Substitut de sed            \\
        hexyl        & Substitut de hexdump        \\
        broot        & Explorateur de fichiers CLI \\
        fzf          & Outil de recherche floue    \\
        git-delta    & Substitut de git diff       \\
    \end{tabularx}

\end{multicols}
\end{document}
