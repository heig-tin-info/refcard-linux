%\documentclass[10pt]{article}
\documentclass[9pt]{extarticle}

\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{heiglogo}
\usepackage[a4paper,landscape,margin=10mm]{geometry}
\usepackage{multicol}
\setlength{\columnsep}{5mm}
\setlength{\columnseprule}{0.4pt}

\usepackage{fontawesome}
\usepackage[most]{tcolorbox}
\usepackage{fontspec}
% \setmainfont{TeX Gyre Heros}
% \setsansfont{TeX Gyre Heros}
% \setmonofont{Inconsolata}
\renewcommand{\familydefault}{\sfdefault}

\usepackage[french]{babel}

\usepackage{microtype}
\usepackage{enumitem}
\setlist{nosep,leftmargin=1.1em}
\setlength{\parindent}{0pt}
\setlength{\parskip}{2pt}

\usepackage{listings}
\lstset{
  basicstyle=\ttfamily\footnotesize,
  columns=flexible,
  keepspaces=true,
  upquote=true,
  breaklines=true
}

\newtcbox{\inlinecode}{nobeforeafter,
  colframe=black!40, colback=black!5,
  boxrule=0.3pt, arc=2pt,
  boxsep=1pt, % padding global
  left=1.5pt, right=1.5pt, top=1.5pt, bottom=1.5pt, % marges internes
  tcbox raise base,
  fontupper=\ttfamily\footnotesize
}

%\lstMakeShortInline[columns=flexible]{|}

%\newcommand{\lstcode}[1]{\inlinecode{#1}}
% remplace ta définition existante
\newcommand{\lstcode}[1]{\inlinecode{\detokenize{#1}}}
\newcommand{\lstc}[1]{\inlinecode{#1}}

\usepackage[os=win]{menukeys}
\renewmenumacro{\keys}[+]{roundedkeys}

\let\oldkeys\keys
\renewcommand{\keys}[1]{\footnotesize\oldkeys{#1}\normalsize}

\renewcommand{\familydefault}{\sfdefault}

\usepackage{titlesec}

% Tailles des titres (s'applique aussi aux versions étoilées *)
\titleformat{\section}
  {\sffamily\bfseries\fontsize{12}{15}\selectfont} % ajoute  si tu veux en gras
  {}{0pt}{}

\titleformat{\subsection}
  {\sffamily\bfseries\fontsize{10}{12}\selectfont}
  {}{0pt}{}

\titleformat{\subsubsection}
  {\sffamily\bfseries\fontsize{8}{10}\selectfont}
  {}{0pt}{}

% Espacements (les tiens, inchangés)
\titlespacing*{\section}{0pt}{0.1ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}
\titlespacing*{\subsection}{0pt}{0.1ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}
\titlespacing*{\subsubsection}{0pt}{0.1ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}


\pagenumbering{gobble}

% \titlespacing*{\section}{0pt}{0.5ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}
% \titlespacing*{\subsection}{0pt}{0.5ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}
% \titlespacing*{\subsubsection}{0pt}{0.5ex plus .1ex minus 0.1ex}{0.5ex plus .1ex minus 0.1ex}

\newlength\mybaselinestretch
\mybaselinestretch=0pt plus 0.02pt\relax
\addtolength{\baselineskip}{\mybaselinestretch}

\setlength\parindent{0pt}
\setlength\tabcolsep{1.5pt}
\setlength{\columnseprule}{0.4pt}

\input{revision}

% % Largeur de la colonne "commande" + écart
% \newlength{\cmdlabelwidth} \setlength{\cmdlabelwidth}{2.8cm} % ajuste au besoin
% \newlength{\cmdlabelsep}   \setlength{\cmdlabelsep}{0.4em}

% % Bloc de commandes compact
% \newenvironment{cmdblock}{%
%   \par\setlength{\parindent}{0pt}\setlength{\parskip}{0pt}%
% }{\par}

% % Une ligne "commande — description" compacte avec wrap automatique
% \newcommand{\cmditem}[2]{%
%   \noindent
%   \makebox[\cmdlabelwidth][l]{\inlinecode{#1}}%
%   \hspace{\cmdlabelsep}%
%   \parbox[t]{\dimexpr\linewidth-\cmdlabelwidth-\cmdlabelsep\relax}{#2}%
%   \par
% }

% PRÉREQUIS
\usepackage{environ}
\usepackage{ragged2e} % pour \RaggedRight

% style de code inline (ton tcolorbox)
% \usepackage[most]{tcolorbox}
% \newtcbox{\inlinecode}{nobeforeafter,
%   colframe=black!40, colback=black!5,
%   boxrule=0.4pt, arc=2pt,
%   boxsep=1pt, left=3pt, right=3pt, top=2pt, bottom=2pt,
%   tcbox raise base,
%   fontupper=\ttfamily\footnotesize
% }

% écart entre la colonne commande et la description
\newlength{\cmdlabelsep} \setlength{\cmdlabelsep}{0.4em}

% largeur “colonne commande” (calculée à la volée)
\newlength{\cmdlabelwidth}

% Définitions par défaut (pour éviter “undefined”)
% \newcommand{\cmditem}[2]{} % placeholder
% \newcommand{\cmdline}[2]{% rendu final d’une ligne
%   \noindent
%   \makebox[\cmdlabelwidth][l]{\inlinecode{#1}}%
%   \hspace{\cmdlabelsep}%
%   \begin{minipage}[t]{\dimexpr\linewidth-\cmdlabelwidth-\cmdlabelsep\relax}
%     \RaggedRight #2%
%   \end{minipage}\par
% }

% Bloc avec mesure automatique de la largeur max
% \NewEnviron{cmdblock}{%
%   % 1) Passe de mesure (aucune sortie)
%   \setlength{\cmdlabelwidth}{0pt}%
%   \setbox0=\vbox{%
%     \renewcommand{\cmditem}[2]{%
%       \sbox2{\inlinecode{##1}}%
%       \ifdim\wd2>\cmdlabelwidth
%         \global\setlength{\cmdlabelwidth}{\wd2}%
%       \fi
%     }%
%     \BODY
%   }%
%   % 2) Composition réelle
%   \renewcommand{\cmditem}[2]{\cmdline{##1}{##2}}%
%   \BODY
% }
\newenvironment{cmdblock}{%
  \par\setlength{\parindent}{0pt}\setlength{\parskip}{0pt}%
}{\par}

\newcommand{\cmditem}[2]{%
  \noindent\inlinecode{#1}\quad #2\par
}
% indentation supplémentaire pour les sous-lignes (options)
\newlength{\cmdoptindent}
\setlength{\cmdoptindent}{1em} % ajuste au goût

\newcommand{\cmdopt}[1]{%
  \hspace*{\cmdoptindent}%
  \begin{minipage}[t]{\dimexpr\linewidth-\cmdoptindent\relax}
    \RaggedRight \itshape #1%
  \end{minipage}\par
}

% \usepackage{xparse}
% \usepackage{tikz}
% \usetikzlibrary{shapes.geometric}
% % distance marge droite -> bord gauche de la règle
% \newlength{\mcRuleOffset}
% \setlength{\mcRuleOffset}{\dimexpr\columnsep/2 - \columnseprule/2\relax}

% % petit triangle contour, pointe vers la droite, collé à la règle
% \newcommand{\mcChevbox}[2]{%
%   \hbox to \linewidth{%
%     \hfil
%     \makebox[0pt][l]{\hskip \mcRuleOffset
%       \tikz[baseline]{%
%         \node[
%           isosceles triangle,
%           shape border rotate=-90,
%           draw, fill=none,
%           inner sep=0pt,
%           minimum width=#1,
%           minimum height=#2,
%           anchor=east
%         ] {};
%       }%
%     }%
%   }%
% }

% % \placeChevron[<largeur>=6pt][<hauteur>=8pt]
% \NewDocumentCommand{\placeChevron}{O{6pt} O{8pt}}{%
%   \begingroup
%   \ifhmode
%     \vadjust pre{\mcChevbox{#1}{#2}}%
%   \else
%     \nointerlineskip\smash{\mcChevbox{#1}{#2}}%
%   \fi
%   \endgroup
% }

\newcommand{\codefa}[2][]{%
  \raisebox{-0.15ex}{\faIcon[#1]{#2}}%
}
\begin{document}

\begin{multicols}{4}
\raggedbottom

\begin{tabularx}{\columnwidth}{lX}
    \raisebox{-2em}{\includegraphics[height=5em]{assets/linux-logo.pdf}} &
    \begin{raggedright}
      {\Large \bf Linux / Unix} \\
      HEIG-VD -- version \revision \ -- \revisiondate \\
    \end{raggedright}
\end{tabularx}
\begin{raggedright}
Carte de référence des commandes et utilitaires Linux/Unix courants. Les marqueurs suivants sont utilisés : \lstcode{[f]} : nom de fichier,
\lstcode{[d]} : nom de répertoire,
\lstcode{[cmd]} : commande,
\lstcode{"s"} : chaîne de caractères
\end{raggedright}

  % File:  {\scriptsize\faFileO\par}
  % Folder: {\scriptsize\faFolderO\par}

\section*{Raccourcis clavier Bash}
\subsection*{Mouvements}

\begin{tabularx}{\columnwidth}{lX}
\keys{\ctrl + B} & recule d'un caractère \\
\keys{\ctrl + F} & avance d'un caractère \\
\keys{\ctrl + A} & début de ligne \\
\keys{\ctrl + E} & fin de ligne \\
\keys{\Alt + B} & recule d'un mot \\
\keys{\Alt + F} & avance d'un mot \\
\end{tabularx}

\subsection*{Édition}

\begin{tabularx}{\columnwidth}{lX}
\keys{\ctrl + H} & comme backspace (\keys{\backspace}) \\
\keys{\ctrl + D} & comme delete (\keys{\del}) \\
\keys{\ctrl + U} & coupe du début au curseur \\
\keys{\ctrl + K} & coupe du curseur à la fin \\
\keys{\ctrl + W} & coupe le mot avant le curseur \\
\keys{\ctrl + Y} & colle le dernier texte coupé \\
\keys{\ctrl + T} & swap le char courant avec le précédent \\
\keys{\Alt + D} & supprime le mot après \\
\keys{\Alt + .} & insère le dernier argument \\
\end{tabularx}

\subsection*{Exécution / complétion}

\begin{tabularx}{\columnwidth}{lX}
\multicolumn{2}{l}{\keys{\ctrl + J}, \keys{\ctrl + M} exécuter (\keys{\return})} \\
\keys{\ctrl + I} & complétion (équivalent \keys{\tab}) \\
\keys{\tab}{} & auto-complétion \\
\end{tabularx}

\subsection*{Contrôle / Appels système}

\begin{tabularx}{\columnwidth}{lX}
\keys{\ctrl + C} & interrompre (\emph{sigint}) \\
\keys{\ctrl + Z} & suspendre (\emph{sigstp}) \\
\keys{\ctrl + L} & effacer l'écran \\
\keys{\ctrl + D} & envoyer \emph{EOF} (ferme le shell) \\
\end{tabularx}

\subsection*{Casse / mots}

\begin{tabularx}{\columnwidth}{lX}
\keys{\Alt + U} & majuscules (mot après) \\
\keys{\Alt + L} & minuscules (mot après) \\
\keys{\Alt + C} & capitalise la première lettre \\
\end{tabularx}

\subsection*{Historique / recherche}

\begin{tabularx}{\columnwidth}{lX}
\keys{\ctrl + R} & recherche historique \\
\keys{\ctrl + G} & annuler la recherche \\
\keys{\ctrl + P} & commande précédente \\
\keys{\ctrl + N} & commande suivante \\
\keys{\ctrl + S} & pause (débloquer: \keys{\ctrl + Q}) \\
\keys{\Alt}+\keys{<} & début de l'historique \\
\keys{\Alt}+\keys{>} & fin de l'historique \\
\keys{\Alt}+\keys{P} & préc. dans l'historique\\
\keys{\Alt}+\keys{N} & suiv. dans l'historique \\
\end{tabularx}

\section*{Sucres syntaxiques}

\begin{tabularx}{\columnwidth}{lX}
\lstcode{~} & identique à \lstc{\$HOME} \\
\lstcode{.} & répertoire courant \\
\lstcode{..} & répertoire parent \\
\lstcode{!!} & dernière commande \\
\lstcode{!n} & commande \#n de l'historique \\
\lstc{\$?} & code retour dernière commande \\
\lstc{\$0} & nom du script \\
\lstcode{!*} & arguments ancienne command \\
\lstcode{^abc^123} & substitution dans dernière cmd. \\
\lstcode{`cmd`} & obsolète, préférer \lstc{\$(cmd)} \\
\lstc{\$(cmd)} & substitution de commande \\
\lstc{\${var}} & rendu de variable \\
\lstcode{{a,b,c}} & expansion par alternatives \\
\lstcode{{1..5}} & expansions de séquence \\
\lstc{\$(cmd1; cmd2)} & sous-coquille \\
\lstc{\$(cmd \&)} & arrière-plan (sous-coquille) \\
\lstc{\$(( expr ))} & arithmétique \\
\end{tabularx}

\section*{Redirections / pipes}
\begin{tabularx}{\columnwidth}{lX}
\lstc{cmd > f} & stdout \textrightarrow{} fichier (écrase) \\
\lstc{cmd >> f} & stdout \textrightarrow{} fichier (ajout) \\
\lstc{cmd 2> f} & stderr \textrightarrow{} fichier (écrase) \\
\lstc{cmd \&> f} & stdout+stderr \textrightarrow{} fichier (écrase) \\
\lstc{cmd \&>> f} & stdout+stderr \textrightarrow{} fichier (ajout) \\
\lstc{cmd < f} & stdin depuis fichier \\
\lstc{cmd << EOF} & heredoc (jusqu'à EOF) \\
\lstc{cmd <<< "s"} & here-string (inject sur stdin) \\
\lstc{cmd1 | cmd2} & pipe (stdout \textrightarrow{} stdin) \\
\lstc{cmd1 |\& cmd2} & pipe (stdout+stderr \textrightarrow{} stdin) \\
\end{tabularx}

\section*{Utilisateur}
\begin{cmdblock}
\cmditem{uptime}{temps de fonctionnement depuis reboot}
\cmditem{date}{date et heure actuelles}
\cmditem{cal}{calendrier du mois en cours}
\cmditem{whoami}{nom de l'utilisateur courant}
\end{cmdblock}

\section*{Fichiers / répertoires}

\begin{cmdblock}
  \cmditem{pwd}{chemin répertoire courant}
  \cmditem{ls}{liste les fichiers}
  \cmdopt{\lstcode{-l} détails, \lstcode{-a} fichiers cachés,
          \lstcode{-h} tailles lisibles, \lstcode{-R} récursif,
          \lstcode{-t} trier par date, \lstcode{-r} ordre inverse,
          \lstcode{-Q} guillemets, \lstcode{-i} inode,
          \lstcode{-d} répertoires seulement, \lstcode{-S} trier par taille,
          \lstcode{-1} un par ligne}
  \cmditem{cd [d]}{change de répertoire}
  \cmditem{touch [f]}{crée fichier vide ou met à jour date}
  \cmditem{mkdir [d]}{crée un répertoire.}
  \cmdopt{\lstcode{-v} verbeux,
    \lstcode{-p} parents si besoin,
    \lstcode{-m [perms]} permissions}
  \cmditem{rmdir [d]}{supprime un répertoire vide}
  \cmditem{rm [f]}{supprime un fichier.}
  \cmdopt{\lstcode{-i} interactif,
    \lstcode{-f} force,
    \lstcode{-v} verbeux,
    \lstcode{-r} récursif}

  \cmditem{cp [src] [dst]}{copie un fichier/répertoire.}
  \cmdopt{\lstcode{-a} archive (récursif + attributs),
    \lstcode{-i} interactif,
    \lstcode{-f} force,
    \lstcode{-v} verbeux,
    \lstcode{-r} récursif}
  \cmditem{mv [src] [dst]}{déplace/renomme.}
  \cmdopt{\lstcode{-i} interactif,
    \lstcode{-f} force,
    \lstcode{-n} ne pas écraser,
    \lstcode{-v} verbeux}
\end{cmdblock}

\section*{Exécution de commandes}
\lstcode{source [fichier]} \\
\lstcode{./[fichier]} (exécutable) \\

\section*{Consultation de fichiers}

\begin{cmdblock}
\cmditem{file [f]}{type du fichier}
\cmditem{stat [f]}{infos détaillées}
\cmditem{wc [f]}{compte occurences}
\cmdopt{\lstcode{-l} lignes, \lstcode{-w} mots, \lstcode{-c} caractères}
\cmditem{head [f]}{affiche premières lignes}
\cmdopt{\lstcode{-n N} N premières lignes}
\cmditem{tail [f]}{affiche les dernières lignes}
\cmdopt{\lstcode{-n N} N dernières lignes,
        \lstcode{-f} temps réel}
\cmditem{less [f]}{affiche page par page}
\cmditem{cat [f]}{affiche le contenu}
\cmditem{hexdump -C [f]}{affiche en hexadécimal}
\cmditem{diff [f1] [f2]}{comparaison ligne par ligne}
\end{cmdblock}

\section*{Variables d'environnement}
\begin{cmdblock}
\cmditem{set}{liste variables et fonctions}
\cmditem{env}{liste les variables d'env.}
\cmditem{export VAR=[s]}{crée/mod. variable d'env.}
\cmditem{echo \$VAR}{affiche valeur variable}
\cmditem{\$PATH}{chemin des exécutables}
\cmditem{\$HOME}{répertoire personnel}
\cmditem{\$SHELL}{interpréteur de commandes}
\cmditem{\$USER}{nom de l'utilisateur}
\cmditem{\$PS1}{invite de commande}
\cmditem{\$PWD}{répertoire courant}
\cmditem{\$OLDPWD}{répertoire précédent}
\end{cmdblock}

\section*{Processus / jobs}
\begin{cmdblock}
\cmditem{[cmd]\&}{exécute en arrière-plan}
\cmditem{jobs}{liste les jobs en cours}
\cmditem{wait [PID]}{attend la fin d'un job}
\cmditem{disown [PID]}{détache un job du shell}
\cmditem{fg [j]}{ramène un job au premier plan}
\cmditem{bg [j]}{relance un job en arrière-plan}
\cmditem{ps aux}{liste les processus}
\cmditem{kill [pid]}{termine un processus}
\cmditem{killall [p]}{termine tous les processus nommés}
\cmditem{top}{moniteur de processus}
\cmditem{htop}{top amélioré (si installé)}

\end{cmdblock}

\section*{Archives / compression}
\lstcode{tar -czvf archive.tar.gz [f]} crée archive .tar.gz \\
\lstcode{tar -xzvf archive.tar.gz} extrait archive .tar.gz \\
\lstcode{zip archive.zip [f]} crée archive .zip \\
\lstcode{unzip archive.zip} extrait archive .zip \\
\lstcode{tar -cJvf archive.tar.xz [f]} crée archive .tar.xz \\
\lstcode{tar -xJvf archive.tar.xz} extrait archive .tar.xz \\
\lstcode{7z a archive.7z [f]} crée archive .7z \\
\lstcode{7z x archive.7z} extrait archive .7z \\
\lstcode{bsdtar -xf [f]} extrait \\
\lstcode{bsdtar -cf archive.tar [f]} crée archive .tar \\

\section*{Permissions / utilisateurs}

\begin{cmdblock}
\cmditem{chmod}{modifie les permissions}
\cmdopt{\lstcode{u} user, \lstcode{g} group, \lstcode{o} others, \lstcode{a} all,
        \lstcode{+} add, \lstcode{-} remove, \lstcode{=} set exactly}
\cmditem{chown}{change le propriétaire}
\cmditem{chgrp}{change le groupe}
\cmditem{umask}{masque de création de fichiers}
\cmditem{sudo [cmd]}{exécute en superutilisateur}
\cmditem{su [utilisateur]}{change d'utilisateur}
\cmditem{who}{qui est connecté}
\cmditem{w}{qui est connecté et que font-ils}
\cmditem{id}{informations sur l'utilisateur courant}
\cmditem{groups}{groupes de l'utilisateur courant}
\cmditem{passwd}{change le mot de passe}
\cmditem{last}{historique des connexions}
\end{cmdblock}

\textit{bits :} 1 x, 2 w, 4 r \\
Exemples : \lstinline|chmod 755 f| (\lstinline|rwxr-xr-x|), \lstinline|chmod 644 f|, \lstinline|chmod u+x f|, \lstinline|chmod g-w f|, \lstinline|chmod o=r f|, \lstinline|chmod a+x f| \\

\section*{Raccourcis less / more / man}
Espace: page suivante, \keys{b}: page précédente \\
\keys{\return}{}: ligne suivante, \keys{y}: ligne précédente \\
\keys{/}: rechercher, \keys{n}/\keys{N}: suivant/précédent \\
\keys{g}/\keys{G}: début/fin, \keys{q}: quitter \\
\keys{h}: aide, \keys{m}: marque-page \\
\keys{'}: aller au marque-page, \keys{`}: revenir \\

\section*{Git}
\begin{cmdblock}
\cmditem{git init}{initialise un dépôt git}
\cmditem{git status}{statut du dépôt}
%\cmditem{git remote add origin [url]}{ajoute une origine}
\cmditem{git remote -v}{liste les origines}
\cmditem{git fetch}{récupère les changements distants}
\cmditem{git pull}{pull + merge}
\cmditem{git push}{pousse les changements locaux}
\cmditem{git clone [url]}{clone un dépôt distant}
\cmditem{git branch}{liste les branches}
\cmditem{git branch [br]}{crée une branche}
\cmditem{git checkout [br]}{change de branche}
\cmditem{git commit -m "s"}{crée un commit}
\cmditem{git add [f]}{ajoute un fichier au commit}
\cmditem{git log}{historique des commits}
\cmdopt{\lstcode{--oneline} résumé, \lstcode{--graph} graphe,
        \lstcode{--stat} stats, \lstcode{-p} diff}
\end{cmdblock}

\section*{GCC}
\begin{cmdblock}
\cmditem{gcc [f.c]}{compile un fichier C}
\cmdopt{\lstcode{-o f} nom de l'exécutable,
        \lstcode{-Wall} tous les avertissements,
        \lstcode{-Wextra} avertissements supplémentaires,
        \lstcode{-g} infos debug,
        \lstcode{-O0, -O1, -O2, -O3} optimisation,
        \lstcode{-std=c17} standard C,
        \lstcode{-I dir} inclure répertoire dir,
        \lstcode{-L dir} lier répertoire dir,
        \lstcode{-l lib} lier la bibliothèque lib
        \lstcode{-c} compiler seulement (pas linker)}
\cmditem{g++ [f.cpp]}{compile un fichier C++}
\end{cmdblock}

\section*{Recherche}
\begin{cmdblock}
\cmditem{grep "s" [f]}{cherche une chaîne dans un fichier}
\cmdopt{\lstcode{-P} regex Perl,
        \lstcode{-r} récursif,
        \lstcode{-i} ignore la casse,
        \lstcode{-v} inverse (non),
        \lstcode{-n} numéro de ligne,
        \lstcode{-c} compte les lignes,
        \lstcode{-l} liste les fichiers,
        \lstcode{-w} mot entier,
        \lstcode{-A n} n lignes après,
        \lstcode{-B n} n lignes avant,
        \lstcode{-C n} n lignes contexte,
        \lstcode{-o} seulement correspondance}
\cmditem{rg "s" [f]}{comme grep, plus rapide (si installé)}
\cmditem{find [d] -name "s"}{cherche un fichier}
\cmdopt{\lstcode{-iname} ignore la casse,
        \lstcode{-type f/d} fichier/répertoire,
        \lstcode{-exec cmd \{\} \;} exécute cmd sur chaque fichier}
\cmditem{locate "s"}{cherche un fichier (base de données)}
\cmditem{which [cmd]}{chemin d'une commande}
\end{cmdblock}

\section*{Remplacement}
\begin{cmdblock}
\cmditem{sed 's/search/new/g' [f]}{remplace avec BRE regex}
\cmdopt{\lstcode{-i} modifie le fichier,
        \lstcode{-n} n'affiche rien par défaut,
        \lstcode{-E} regex étendues,
        \lstcode{-e} script, \lstcode{-r} regex étendues}
\cmditem{perl -pe 's/search/new/g' [f]}{remplace avec regex Perl}
\cmdopt{\lstcode{-i} modifie le fichier,
        \lstcode{-n} n'affiche rien par défaut,
        \lstcode{-e} script, \lstcode{-l} gère les nouvelles lignes}
\cmditem{perl -0777 -pe 's/search/new/gs' [f]}{remplace sur tout le fichier}
\end{cmdblock}

\section*{Utilitaires}
\begin{cmdblock}
\cmditem{uniq [f]}{filtre les lignes consécutives identiques}
\cmdopt{\lstcode{-c} compte, \lstcode{-d} que les doublons,
        \lstcode{-u} que les uniques, \lstcode{-i} ignore la casse}
\cmditem{sort [f]}{trie les lignes}
\cmdopt{\lstcode{-r} inverse, \lstcode{-n} numérique,
        \lstcode{-k n} clé n, \lstcode{-u} unique,
        \lstcode{-t x} séparateur x}
\cmditem{cut -d x -f n [f]}{extrait le champ n, séparé par x}
\cmditem{awk '{print \$n}' [f]}{extrait le champ n (espace séparateur)}
\cmditem{xargs [cmd]}{construit des lignes de commande}
\cmdopt{\lstcode{-n N} N arguments par commande,
        \lstcode{-I \{\}} remplace \{\} par l'argument}
\cmditem{tr 'set1' 'set2'}{remplace set1 par set2}
\cmdopt{\lstcode{-d} supprime set1, \lstcode{-s} squeeze}
\cmditem{tee [f]}{duplique le flux vers un fichier}
\cmdopt{\lstcode{-a} ajoute au fichier, \lstcode{-i} ignore les signaux}
\end{cmdblock}

\section*{Aide}
\begin{cmdblock}
\cmditem{help [cmd]}{aide interne bash}
\cmditem{[cmd] --help}{aide d'une commande}
\cmditem{man [cmd]}{manuel d'une commande}
\cmditem{apropos [terme]}{cherche dans les manuels}
\cmditem{whatis [cmd]}{description commande}
\end{cmdblock}

\emph{Sections du manuel: 1 utilisateur, 2 syscalls, 3 lib, 4 spéciaux, 5 formats, 6 jeux, 7 divers, 8 admin} \\

\section*{Gestion Réseau}
\begin{cmdblock}
\cmditem{ip a}{liste adresses IP}
\cmditem{ip r}{table de routage}
\cmditem{ping [hôte]}{teste la connectivité}
\cmditem{ss -tuln}{sockets réseau}
\cmditem{dig [hôte]}{résolution DNS avancée}
\end{cmdblock}

\section*{Internet}
\begin{cmdblock}
\cmditem{ssh user@host}{connexion SSH}
\cmditem{scp [src] [dst]}{copie sécurisée}
\cmditem{wget [url]}{télécharge un fichier}
\cmdopt{\lstcode{-O f} fichier de sortie,
        \lstcode{-c} reprendre, \lstcode{-q} silencieux,
        \lstcode{--limit-rate=100k} limite le débit}
\cmditem{curl [url]}{transfère une URL}
\cmdopt{\lstcode{-o f} fichier de sortie,
        \lstcode{-O} nomme comme l'original,
        \lstcode{-L} suivre redirections,
        \lstcode{-I} en-têtes seulement,
        \lstcode{-d data} données POST,
        \lstcode{-H 'Hdr: v'} ajoute un en-tête}
\cmditem{lynx [url]}{navigateur web en console}
\end{cmdblock}

\section*{Env. virtuels Python}
\lstinline|uv venv venv| \quad \lstinline|source venv/bin/activate| \\
\lstinline|deactivate| \\
\lstinline|pip install pkg| \quad \lstinline|pip uninstall pkg| \\
\lstinline|pip list| \quad \lstinline|uv add pkg| \\
\lstinline|pipx install pkg| \\

\section*{Système}

\begin{cmdblock}
\cmditem{shutdown -h now}{arrête le système}
\cmditem{shutdown -r now}{redémarre le système}
\cmditem{systemctl status [service]}{statut d'un service}
\cmditem{systemctl start [service]}{démarre un service}
\cmditem{systemctl stop [service]}{arrête un service}
\cmditem{systemctl restart [service]}{redémarre un service}
\cmditem{systemctl enable [service]}{active un service au démarrage}
\cmditem{systemctl disable [service]}{désactive un service au démarrage}
\cmditem{journalctl -xe}{logs système}
\cmditem{timedatectl}{date, heure, fuseau horaire}
\cmditem{hostnamectl}{informations sur le système}
\end{cmdblock}

\section*{Hardware}

\begin{cmdblock}
\cmditem{uname -a}{informations système}
\cmditem{lscpu}{infos CPU}
\cmditem{lsblk}{liste les disques et partitions}

\cmditem{df -h}{espace disque}
\cmditem{du -sh [f/d]}{taille d'un fichier/répertoire}
\cmditem{free -h}{mémoire}
\end{cmdblock}

\section*{APT (Debian/Ubuntu)}
\begin{cmdblock}
\cmditem{apt update}{met à jour liste des paquets}
\cmditem{apt upgrade}{met à jour les paquets installés}
\cmditem{apt install [pkg]}{installe un paquet}
\cmditem{apt remove [pkg]}{désinstalle un paquet}
\cmditem{apt search [terme]}{cherche un paquet}
\cmditem{apt show [pkg]}{informations sur un paquet}
\cmditem{apt autoremove}{supprime dépendances inutiles}
\cmditem{dpkg -L [pkg]}{liste fichiers d'un paquet}
\cmditem{dpkg -S [f]}{quel paquet fournit ce fichier}
\end{cmdblock}

% \section*{À installer (exemples)}
% \textbf{Utilitaires} : \lstinline|sudo apt install util-linux coreutils findutils grep sed awk wget curl unzip zip tar| \\
% \textbf{Manuels FR} : \lstinline|sudo apt install manpages-fr manpages-fr-extra| \\
% \textbf{Dev} : \lstinline|sudo apt install build-essential git curl wget vim htop| \\
% \textbf{Réseau} : \lstinline|sudo apt install net-tools iputils-ping traceroute dnsutils| \\

\section*{Fun}

\begin{cmdblock}
\cmditem{cowsay "s"}{phylactere et vache}
\cmditem{fortune}{citation aléatoire }
\cmditem{sl}{locomotive à vapeur }
\cmditem{cmatrix}{effet Matrix }
\cmditem{toilet "s"}{texte ASCII art }
\cmditem{lolcat}{texte coloré }
\end{cmdblock}

\section*{Substituts modernes conseillés}

\begin{tabularx}{\columnwidth}{lX}
lsd & Substitut de ls  \\
batcat& Amélioration de cat  \\
fd & Substitut de find  \\
ripgrep (rg) & Substitut de grep  \\
sd & Substitut de sed  \\
hexyl & Substitut de hexdump  \\
broot & Explorateur de fichiers CLI  \\
fzf & Outil de recherche floue  \\
git-delta & Substitut de git diff \\
\end{tabularx}

\end{multicols}
\end{document}
